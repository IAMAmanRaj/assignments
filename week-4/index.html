<!DOCTYPE html>
<html>

<head>
  <script>
    let globalId = 1;
    let todoState = [];
    let oldTodoState = [];

function markAsDone(todoId){
  const parent=document.getElementById(todoId);
  for(let old of oldTodoState)
  {
    if(old.id===todoId){
      old.completed=true;
    
      break;
    }
  }
  parent.children[2].innerHTML="Done!"

}

function createChild(title,description,id)
{
  const child=document.createElement("div");
  const firstGrandChild=document.createElement("div");
  firstGrandChild.innerHTML=title;
  const secondGrandChild=document.createElement("div");
  secondGrandChild.innerHTML=description;
  const thirdGrandChild=document.createElement("button");
  thirdGrandChild.innerHTML="Mark as Done";
  thirdGrandChild.setAttribute("onclick",`markAsDone(${id})`);
  child.appendChild(firstGrandChild);
  child.appendChild(secondGrandChild);
  child.appendChild(thirdGrandChild);
  child.setAttribute("id",id);
  return child;
}


    function addTodoToDom(todo) {
const parent=document.getElementById("todos");
const title=todo.title,description=todo.description,id=todo.id;
parent.appendChild(createChild(title,description,id));
      
    }

    function removeTodoFromDom(todo) {
      const element=document.getElementById(todo.id);
      element.parentElement.removeChild(element);
      
    }

    function updateTodoInDom(oldTodo, newTodo) {
      const element=document.getElementById(newTodo.id);
      element.children[0].innerHTML=newTodo.title;
      element.children[1].innerHTML=newTodo.description;
      element.children[2].innerHTML=newTodo.completed? "Mark as done":"Done";
        
    }

    function updateState(newTodos) {
      // calculate the diff b/w newTodos and oldTodos.
      // More specifically, find out what todos are - 
      // 1. added
      // 2. deleted
      // 3. updated
      const added = [];
      const deleted = [];
      const updated = [];
      // calculate these 3 arrays
      // call addTodo, removeTodo, updateTodo functions on each of the
      // elements

      for(let todo of newTodos)
      {
        let found=false;
        for(let old of oldTodoState){
          if(old.id==todo.id)
          {
            found=true;
            if(old.title!=todo.title || old.description!=todo.description || old.completed!=todo.completed)
            {
              updated.push(todo)
              break;
            }
          }
        }
        if(!found)
        {
          added.push(todo);
        }
      }
      for(let old of oldTodoState)
      {
        let found=false;
        for(let todo of newTodos)
        {
          if(old.id===todo.id)
          {
            found=true;
            break;
          }
        }
        if(!found){
          deleted.push(old);
        }
      }
      console.log('Added: ');
      console.log(added);
      console.log('Removed: ');
      console.log(deleted);
      console.log('Updated: ');
      console.log(updated);
      added.forEach(addTodoToDom);
      deleted.forEach(removeTodoFromDom);
      updated.forEach(updateTodoInDom)
      oldTodoState = [...newTodos];
    }

    function addTodo() {
      const title = document.getElementById("title").value;
      const description = document.getElementById("description").value;
      todoState.push({
        title: title,
        description: description,
        id: globalId++,
      })
      updateState(todoState);
    }
  </script>
</head>

<body>
  <input type="text" id="title" placeholder="Todo title"></input> <br /><br />
  <input type="text" id="description" placeholder="Todo description"></input> <br /><br />
  <button onclick="addTodo()">Add todo</button>
  <br /> <br />

  <div id="todos">

  </div>
</body>

</html>